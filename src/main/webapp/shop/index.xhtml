<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core"
  xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:p="http://primefaces.org/ui">
<ui:composition template="/templates/shop.xhtml">
  <ui:define name="mainContent">
    <p:dataGrid id="shopFrontProductTable" var="product" value="#{shopFrontBean.products}" columns="3" paginator="false">
      <h:panelGrid styleClass="shopFrontProductDetailsTable" columns="1">
        <h:outputText styleClass="shopFrontName" value="#{product.name}" />
        <h:panelGroup id="shopFrontImagePanel">
          <p:graphicImage styleClass="shopFrontImage" value="http://placehold.it/245x245" />
        </h:panelGroup>
        <h:outputText styleClass="shopFrontDescription" value="#{product.description}" />
        <h:panelGroup rendered="#{product.numVariants > 1}">
          <p:selectOneMenu value="#{shopFrontBean.selectedVariant}" effect="none" converter="VariantConverter">
            <f:selectItems value="#{product.variantsAsList}" var="variant" itemLabel="#{variant.name}"
              itemValue="#{variant}" />
            <p:ajax event="change" update="shopFrontPricePanel shopFrontStockPanel shopFrontBuyPanel" />
          </p:selectOneMenu>
        </h:panelGroup>
        <h:panelGroup id="shopFrontPricePanel">
          <h:outputText styleClass="shopFrontPrice" value="#{shopFrontBean.variantPrice}" />
        </h:panelGroup>
        <h:panelGroup id="shopFrontStockPanel">
          <h:outputText styleClass="shopFrontStock" value="#{shopFrontBean.variantStockText}" />
        </h:panelGroup>
        <h:panelGroup id="shopFrontBuyPanel">
          <p:commandButton value="#{msg.storeFrontButtonsAddToBasket}" disabled="true"
            rendered="#{shopFrontBean.variantStock == 0}" />
          <p:commandButton value="#{msg.storeFrontButtonsAddToBasket}" action="#{basketBean.addItemToBasket}"
            rendered="#{shopFrontBean.variantStock > 0}">
            <f:setPropertyActionListener target="#{basketBean.product}" value="#{product}" />
            <f:setPropertyActionListener target="#{basketBean.variant}" value="#{shopFrontBean.selectedVariant}" />
          </p:commandButton>
        </h:panelGroup>
      </h:panelGrid>
    </p:dataGrid>
  </ui:define>
</ui:composition>
</html>